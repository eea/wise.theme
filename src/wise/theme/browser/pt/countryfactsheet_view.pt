<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  lang="en"
  metal:use-macro="context/main_template/macros/master"
  i18n:domain="plone">

<metal:content-core fill-slot="content-core">
  <metal:content-core define-macro="content-core">

    <div id="country-factsheet">
      <div class="country-header-container">
        <h1 class="country-title" tal:content="context/Title">Country name</h1>

        <div class="row">
          <div class="col-md-6 ch-col">
            <iframe src="./country_marine_waters_image"
              data-embed-group="esri"
              id="country-maplet"
              tal:attributes="src string:${context/absolute_url}/country_marine_waters_map"></iframe>
          </div>
          <div class="col-md-6 ch-col">
            <div class="row country-data-wrapper">
              <div class="col-md-6 ch-col marine-data">
                <h3 class="marine-title">Marine waters in km<sup>2</sup></h3>
                <table tal:define="stats view/water_stats" class="marine-stats">
                  <tr tal:repeat="kv view/water_stats">
                    <td tal:content="python:kv[0]">Region name</td>
                    <td tal:content="python:view.format_nr(kv[1])">Quantity</td>
                  </tr>
                  <tfoot tal:condition="python: len(stats) > 1">
                    <tr>
                      <td>TOTAL</td>
                      <td tal:content="python: view.format_nr(view.water_stats_total())">Quantity</td>
                    </tr>
                  </tfoot>
                </table>

                <h3><span tal:content="view/country_name"></span> is part of:</h3>
                <div class="country-conventions"
                     tal:define="conventions view/conventions">
                  <span class="dd-title dd-caret-up">Regional Sea Conventions</span>
                  <ul class="dd-content">
                    <li tal:repeat="conv conventions">
                      <a href="" tal:attributes="href conv/Web" tal:content="conv/RSC">OSPAR</a>
                    </li>
                  </ul>
                </div>

                <div tal:define="msfd_website view/msfd_website"
                     tal:condition="msfd_website">
                  <a href="" tal:attributes="href msfd_website/URL">MSFD national website</a>
                  <span tal:condition="msfd_website/Observations">(<span tal:replace="msfd_website/Observations" />)</span>
                </div>

                <div>
                  <a tal:attributes="href view/msp_link">
                    Maritime Spatial Planning (MSP) Country Profile
                  </a>
                </div>

              </div>
              <div class="col-md-6 ch-col">
                <div class="marine-number">
                  <h3>Marine waters per country</h3>
                  <div class="figure-wrapper">
                    <span class="figure-number">
                      <tal:rep tal:replace="python: int(context.marine_water_per_country or 0)">45%</tal:rep>%
                    </span>
                    <span class="figure-content">
                      of the total country area (land &amp; marine)
                    </span>
                  </div>
                </div>
                <div class="marine-number">
                  <h3>Marine waters per capita</h3>
                  <div class="figure-wrapper">
                    <span class="figure-number"
                      tal:content="context/marine_water_per_capita">10</span>
                      <span class="figure-content">
                        <span>ha</span> per capita
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row map-info">
            <div class="col-md-6 ch-col">
              <div class="legend">
                <h3 class="legend-title">Legend</h3>
                <span class="legend-item" tal:repeat="row view/legend">
                  <img tal:attributes="src python:row[1]" />
                  <span tal:content="python:row[0]">Title</span>
                </span>
              </div>
            </div>
            <div class="col-md-6 ch-col">
              <p class="discreet-map-info">
                This map draws on information provided by the Member State to
                represent its marine waters, according to Article 3(1) of the Marine
                Strategy Framework Directive (2008/56/EC). This map is for
                illustrative purposes only and should not be considered as the
                official boundary delimitation between neighboring countries.
                Jurisdictional borders are the sole responsibility of Member States.
                The European Commission and European Environment Agency have no
                responsibility on this matter.
              </p>
            </div>
          </div>
        </div>  <!-- end of country header -->

        <!-- <div class="country-authorities">
          <div class="row">
            <div class="col-md-12"
                tal:define="conventions view/conventions;
                authorities view/authorities;
                msfd_website view/msfd_website">

              <div tal:condition="context/text|nothing"
                   tal:replace="structure context/text/output">
              Rich text here
              </div>

              <div tal:condition="conventions">
                <div><span tal:content="view/country_name">Spain</span> is part of the following Regional Sea Conventions:</div>
                <ul>
                  <li tal:repeat="conv conventions">
                    <a href="" tal:attributes="href conv/Web" tal:content="conv/RSC">OSPAR</a>
                  </li>
                </ul>
              </div>

              <div tal:condition="authorities">
                <div>National Competent Authority(ies) for the MSFD implementation:</div>
                <ul>
                  <li tal:repeat="auth authorities">
                    <a href="" tal:attributes="href auth/href" tal:content="auth/name">OSPAR</a>
                  </li>
                </ul>
              </div>

              <div tal:condition="msfd_website">
                <a href="" tal:attributes="href msfd_website/URL">MSFD national website</a>
                <span tal:condition="msfd_website/Observations">(<span tal:replace="msfd_website/Observations" />)</span>
              </div>

              <div>
                <a tal:attributes="href view/msp_link">
                  Maritime Spatial Planning (MSP) Country Profile
                </a>
              </div>
            </div>
          </div>
        </div> -->

        <div class="country-authorities"
             tal:define="authorities view/authorities"
             tal:condition="authorities">
          <div class="listing-title-wrapper">
            <!-- <h3>Title for list</h3> -->
            <span class="authority-title">National Competent Authority(ies) for the MSFD implementation</span>
            <span class="read-more">Read more</span>
          </div>

          <div class="dd-list">
            <ul>
              <li tal:repeat="auth authorities">
                <a href="" tal:attributes="href auth/href" tal:content="auth/name">OSPAR</a>
              </li>
            </ul>
          </div>
        </div>

        <div class="country-content">
          <div class="row">
            <div class="col-md-12 col-xs-12" >
              <div class="pat-autotoc"
                data-pat-autotoc="appendTo:#toc;scrollduration:slow;levels:h2,h3,h4,h5,h6;appendTo:#toc">

            <script>
              window._tableaus = [];
            </script>
            <div tal:repeat="brain context/getFolderContents"
                 class="country-dashboard-section row">
              <tal:def define="section brain/getObject; height section/dashboard_height; url section/tableau_url | string:">

                <div class="col-md-12">
                  <div class="dashboard-wrapper">
                    <div class="row">
                      <div class="col-md-4 col-xs-12">
                        <h2 class="section-title" tal:content="section/Title"></h2>
                        <div class="dashboard-text"
                          tal:condition="section/text_above_dashboard|nothing"
                          tal:content="structure section/text_above_dashboard/output">Slide text
                        </div>
                      </div>
                      <tal:cond tal:condition="section/tableau_url">
                        <div class="col-md-8 col-xs-12">
                          <div tal:attributes="id string:vis-${repeat/brain/index}"
                               class="factsheet-tableau-vis"></div>
                        </div>
                      </tal:cond>
                    </div>

                    <div
                      tal:condition="section/text|nothing"
                      tal:content="structure section/text/output">Slide text</div>
                  </div>
                </div>

                <script tal:content="string:window._tableaus.push(['${url}', '${height}'])"></script>
              </tal:def>
            </div>
          </div>
        </div>
      </div>
    <!-- <div class="col&#45;md&#45;2 col&#45;xs&#45;4 toc&#45;wrapper"> -->
    <!--   <div class="portlet"> -->
    <!--     <header class="portletHeader">On this page</header> -->
    <!--     <div class="portletContent"> -->
    <!--       <div id="toc"> </div> -->
    <!--     </div> -->
    <!--   </div> -->
    <!-- </div> -->

      </div> <!-- end of country-content -->
    </div>

    <script src="/++theme++wise-theme/static/js/tableau-2.3.0.js"></script>
    <script>
        //<![CDATA[
        jQuery(document).ready(function() {
          console.log(window._tableaus);
          var id, containerDiv, info;
          for(var i = 0; i < window._tableaus.length; i++) {
            id = "vis-" + i;
            containerDiv = document.getElementById(id);
            info = window._tableaus[i];
            if (info[0]) {
              new tableau.Viz(containerDiv, info[0], {height: info[1] || '630px', width: '900px', hideToolbar: true});
            }
          }

          $(function() {
            var $ddItem = $('.dd-title');
            $ddItem.each(function() {
              var $this = $(this);
              $this.click(function() {
                var $this = $(this);
                $this.toggleClass("dd-caret-up dd-caret-down");
                $this.siblings('.dd-content').fadeToggle();
              });
            });

            $('.read-more').click(function() {
              var $this = $(this);
              $this.text(function(a,b) {
                  return (b == "Read more" ? "Read less" : "Read more");
                });
              $this.parents().siblings('.dd-list').fadeToggle();
            });
          });
        });
        //]]>
    </script>

  </metal:content-core>
</metal:content-core>
</html>
