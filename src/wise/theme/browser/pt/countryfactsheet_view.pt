<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  lang="en"
  metal:use-macro="context/main_template/macros/master"
  i18n:domain="plone">

<metal:content-core fill-slot="content-core">
  <metal:content-core define-macro="content-core">

    <div class="container" id="country-factsheet">
      <div class="row">
        <div class="col-md-6">
          <iframe src="./country_marine_waters_image"
            id="country-maplet"
            tal:attributes="src string:${context/absolute_url}/country_marine_waters_map"></iframe>
        </div>
        <div class="col-md-6">
          <h2>Marine waters in km<sup>2</sup></h2>
          <table tal:define="stats view/water_stats">
            <tr tal:repeat="kv view/water_stats">
              <td tal:content="python:kv[0]">Region name</td>
              <td tal:content="python:view.format_nr(kv[1])">Quantity</td>
            </tr>
            <tfoot>
              <tr>
                <td>TOTAL</td>
                <td tal:content="python: view.format_nr(view.water_stats_total())">Quantity</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="marine-number">
            <h4>Marine water per country</h4>
            <span class="figure-number">
              <tal:rep tal:replace="python: int(context.marine_water_per_country or 0)">45%</tal:rep>%
            </span> of the total country area
          </div>
        </div>
        <div class="col-md-6">
          <div class="marine-number">
            <h4>Marine water per capita</h4>
            <span class="figure-number"
              tal:content="python: int(context.marine_water_per_capita or 0)">10</span> ha per capita
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12 country-authorities">
          <div tal:condition="context/text|nothing"
            tal:replace="structure context/text/output">
          <p>Folder description</p>
        </div>
      </div>
    </div>

    <script>
      window._tableaus = [];
    </script>
    <div tal:repeat="brain context/getFolderContents">
      <tal:def define="section brain/getObject; url section/tableau_url | string:">
        <h3 tal:content="section/Title"></h3>
        <div class="container">
          <div class="row" tal:condition="not: section/tableau_url">
          </div>
          <div class="row" tal:condition="section/tableau_url">
            <div class="col-3-md"
              tal:condition="section/text|nothing"
              tal:content="structure section/text/output">Slide text</div>
            <div class="col-9-md">
              <div tal:attributes="id string:vis-${repeat/brain/index}" class="factsheet-tableau-vis"></div>
            </div>
          </div>
        </div>
        <script tal:content="string:window._tableaus.push('${url}')"></script>
      </tal:def>
    </div>

  </div>

  <script src="/++theme++wise-theme/static/js/tableau-2.3.0.js"></script>

  <script>
      //<![CDATA[
      jQuery(document).ready(function() {
      console.log(window._tableaus);

      var id, containerDiv, tabUrl;

      for(var i = 0; i < window._tableaus.length; i++) {
        id = "vis-" + i;
        containerDiv = document.getElementById(id);
        tabUrl = window._tableaus[i];
        if (tabUrl) {
          new tableau.Viz(containerDiv, tabUrl);
        }
      }
      });
      //]]>
  </script>

</metal:content-core>
  </metal:content-core>
</html>
